/* Editor-specific styles for CodeMirror 6 */

/* === CODEMIRROR 6 OVERRIDES === */
.cm-editor {
    height: 100%;
    font-family: "SF Mono", "Monaco", "Inconsolata", "Roboto Mono", monospace;
    font-size: 14px;
    line-height: 1.5;
    display: flex;
    flex-direction: column;
}

.cm-editor.cm-focused {
    outline: none;
    border: none;
}

.cm-content {
    padding: var(--space-4);
    caret-color: var(--editor-cursor);
}

.cm-scroller {
    flex: 1;
    overflow: auto;
    height: 100%;
    min-height: 0;
}

.cm-line {
    padding: 0;
    line-height: 1.6;
}

.cm-cursor {
    border-left: 2px solid var(--editor-cursor);
}

.cm-selectionBackground {
    background: var(--editor-selection) !important;
}

.cm-activeLine {
    background: var(--editor-line-highlight);
}

.cm-activeLineGutter {
    background: var(--editor-line-highlight);
}

/* === GUTTERS === */
.cm-gutters {
    background: var(--editor-gutter-bg);
    border-right: 1px solid var(--editor-border);
    color: var(--editor-gutter-text);
}

.cm-lineNumbers {
    font-family: "SF Mono", "Monaco", "Inconsolata", "Roboto Mono", monospace;
    font-size: 13px;
}

.cm-lineNumbers .cm-gutterElement {
    padding: 0 8px;
    min-width: 40px;
    text-align: right;
}

/* === SEARCH === */
.cm-panel {
    background: var(--panel-bg);
    border: 1px solid var(--panel-border);
    border-radius: var(--radius-base);
    color: var(--panel-text);
}

.cm-searchMatch {
    background: var(--search-match-bg);
    border: 1px solid var(--search-match-border);
    border-radius: 2px;
}

.cm-searchMatch.cm-searchMatch-selected {
    background: var(--search-match-selected-bg);
    border-color: var(--search-match-selected-border);
}

/* === BRACKETS === */
.cm-matchingBracket {
    background: var(--matching-bracket-bg);
    border: 1px solid var(--matching-bracket-border);
    border-radius: 2px;
}

.cm-nonmatchingBracket {
    background: var(--nonmatching-bracket-bg);
    border: 1px solid var(--nonmatching-bracket-border);
    border-radius: 2px;
}

/* === SYNTAX HIGHLIGHTING === */
.editor .cm-keyword {
    color: var(--syntax-keyword);
    font-weight: var(--font-medium);
}

.editor .cm-string {
    color: var(--syntax-string);
}

.editor .cm-number {
    color: var(--syntax-number);
}

.editor .cm-comment {
    color: var(--syntax-comment);
    font-style: italic;
}

.editor .cm-operator {
    color: var(--syntax-operator);
}

.editor .cm-punctuation {
    color: var(--syntax-punctuation);
}

.editor .cm-builtin {
    color: var(--syntax-type);
    font-weight: var(--font-medium);
}

.editor .cm-type {
    color: var(--syntax-type);
    font-weight: var(--font-medium);
}

.editor .cm-constant {
    color: var(--syntax-number);
    font-weight: var(--font-medium);
}

.editor .cm-variable {
    color: var(--syntax-function);
}

.editor .cm-error {
    color: var(--color-error);
    background-color: var(--overlay-error);
}

/* === DIAGNOSTICS === */
.cm-diagnostic-error {
    border-bottom: 2px wavy var(--color-error);
}

.cm-diagnostic-warning {
    border-bottom: 2px wavy var(--color-warning);
}

.cm-diagnostic-info {
    border-bottom: 2px wavy var(--color-info);
}

/* Diagnostic gutter markers */
.cm-lint-marker {
    width: 16px;
    height: 16px;
    border-radius: 50%;
    margin: 2px;
    position: relative;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 10px;
    font-weight: bold;
    color: white;
}

.cm-lint-marker-error {
    background-color: var(--color-error);
}

.cm-lint-marker-warning {
    background-color: var(--color-warning);
}

.cm-lint-marker-info {
    background-color: var(--color-info);
}

/* === EDITOR-SPECIFIC LIGHT THEME COLORS === */
:root {
    --editor-header-bg: var(--bg-secondary);
    --editor-border: var(--border-default);
    --editor-gutter-bg: var(--bg-secondary);
    --editor-gutter-text: var(--text-secondary);

    --panel-bg: var(--bg-elevated);
    --panel-border: var(--border-default);
    --panel-text: var(--text-primary);

    --search-match-bg: rgba(255, 235, 59, 0.4);
    --search-match-border: rgba(255, 235, 59, 0.8);
    --search-match-selected-bg: rgba(255, 193, 7, 0.6);
    --search-match-selected-border: rgba(255, 193, 7, 1);

    --matching-bracket-bg: rgba(34, 134, 58, 0.15);
    --matching-bracket-border: rgba(34, 134, 58, 0.4);
    --nonmatching-bracket-bg: rgba(218, 54, 51, 0.15);
    --nonmatching-bracket-border: rgba(218, 54, 51, 0.4);
}

/* === EDITOR-SPECIFIC DARK THEME COLORS === */
[data-theme="dark"] {
    --editor-header-bg: var(--bg-secondary);
    --editor-border: var(--border-default);
    --editor-gutter-bg: var(--bg-secondary);
    --editor-gutter-text: var(--text-secondary);

    --panel-bg: var(--bg-secondary);
    --panel-border: var(--border-default);
    --panel-text: var(--text-primary);

    --search-match-bg: rgba(255, 235, 59, 0.3);
    --search-match-border: rgba(255, 235, 59, 0.6);
    --search-match-selected-bg: rgba(255, 193, 7, 0.4);
    --search-match-selected-border: rgba(255, 193, 7, 0.8);

    --matching-bracket-bg: rgba(46, 160, 67, 0.2);
    --matching-bracket-border: rgba(46, 160, 67, 0.5);
    --nonmatching-bracket-bg: rgba(248, 81, 73, 0.2);
    --nonmatching-bracket-border: rgba(248, 81, 73, 0.5);
}

/* === RESPONSIVE === */
@media (max-width: 768px) {
    .cm-editor {
        font-size: 13px;
    }

    .cm-content {
        padding: var(--space-3);
    }

    .cm-lineNumbers .cm-gutterElement {
        padding: 0 6px;
        min-width: 35px;
    }
}

/* === ACCESSIBILITY === */
@media (prefers-reduced-motion: reduce) {
    .cm-cursor {
        animation: none;
    }
}

/* High contrast mode */
@media (prefers-contrast: high) {
    .cm-editor {
        border: 2px solid;
    }

    .cm-activeLine {
        background: transparent;
        border-left: 3px solid var(--editor-cursor);
    }
}

/* === SOURCE RANGE HIGHLIGHTING === */
.cm-source-range-highlight {
    background-color: rgba(124, 58, 237, 0.2);
    border-radius: 2px;
    outline: 2px solid rgba(124, 58, 237, 0.4);
    outline-offset: -1px;
}

[data-theme="dark"] .cm-source-range-highlight {
    background-color: rgba(139, 92, 246, 0.3);
    outline-color: rgba(139, 92, 246, 0.5);
}

/* Enhanced selection visibility when highlighting source ranges */
.cm-source-range-active .cm-selectionBackground {
    background-color: rgba(124, 58, 237, 0.4) !important;
}

.cm-source-range-active .cm-focused .cm-selectionBackground {
    background-color: rgba(124, 58, 237, 0.5) !important;
}

[data-theme="dark"] .cm-source-range-active .cm-selectionBackground {
    background-color: rgba(139, 92, 246, 0.4) !important;
}

[data-theme="dark"]
    .cm-source-range-active
    .cm-focused
    .cm-selectionBackground {
    background-color: rgba(139, 92, 246, 0.5) !important;
}
